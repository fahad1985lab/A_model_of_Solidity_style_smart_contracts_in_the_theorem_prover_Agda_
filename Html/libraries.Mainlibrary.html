<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>libraries.Mainlibrary</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda">
<a id="2" class="Keyword">open</a> <a id="7" class="Keyword">import</a> <a id="14" href="constantparameters.html" class="Module">constantparameters</a>

<a id="34" class="Keyword">module</a> <a id="41" href="libraries.Mainlibrary.html" class="Module">libraries.Mainlibrary</a> <a id="63" class="Keyword">where</a>

<a id="70" class="Keyword">open</a> <a id="75" class="Keyword">import</a> <a id="82" href="Data.Nat.html" class="Module">Data.Nat</a>
<a id="91" class="Keyword">open</a> <a id="96" class="Keyword">import</a> <a id="103" href="Data.List.html" class="Module">Data.List</a> <a id="113" class="Keyword">hiding</a> <a id="120" class="Symbol">(</a><a id="121" href="Data.List.Base.html#1810" class="Function Operator">_++_</a><a id="125" class="Symbol">)</a>
<a id="127" class="Keyword">open</a> <a id="132" class="Keyword">import</a> <a id="139" href="Agda.Builtin.Nat.html" class="Module">Agda.Builtin.Nat</a> <a id="156" class="Keyword">using</a> <a id="162" class="Symbol">(</a><a id="163" href="Agda.Builtin.Nat.html#415" class="Primitive Operator">_-_</a><a id="166" class="Symbol">;</a> <a id="168" href="Agda.Builtin.Nat.html#528" class="Primitive Operator">_*_</a><a id="171" class="Symbol">)</a>
<a id="173" class="Keyword">open</a> <a id="178" class="Keyword">import</a> <a id="185" href="Data.Unit.html" class="Module">Data.Unit</a>
<a id="195" class="Keyword">open</a> <a id="200" class="Keyword">import</a> <a id="207" href="Data.Bool.html" class="Module">Data.Bool</a>
<a id="217" class="Keyword">open</a> <a id="222" class="Keyword">import</a> <a id="229" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a>
<a id="244" class="Keyword">open</a> <a id="249" class="Keyword">import</a> <a id="256" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a>
<a id="270" class="Keyword">open</a> <a id="275" class="Keyword">import</a> <a id="282" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="293" class="Keyword">hiding</a> <a id="300" class="Symbol">(</a><a id="301" href="Data.Maybe.Base.html#2227" class="Function Operator">_&gt;&gt;=_</a><a id="306" class="Symbol">)</a>
<a id="308" class="Keyword">open</a> <a id="313" class="Keyword">import</a> <a id="320" href="Data.String.html" class="Module">Data.String</a> <a id="332" class="Keyword">hiding</a> <a id="339" class="Symbol">(</a><a id="340" href="Data.String.Base.html#2430" class="Function">length</a><a id="346" class="Symbol">;</a><a id="347" href="Data.String.Base.html#1561" class="Primitive">show</a><a id="351" class="Symbol">)</a>
<a id="353" class="Keyword">open</a> <a id="358" class="Keyword">import</a> <a id="365" href="Data.Nat.Show.html" class="Module">Data.Nat.Show</a>
<a id="379" class="Keyword">open</a> <a id="384" class="Keyword">import</a> <a id="391" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="407" class="Symbol">as</a> <a id="410" class="Module">Maybe</a> <a id="416" class="Keyword">using</a> <a id="422" class="Symbol">(</a><a id="423" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a><a id="428" class="Symbol">;</a> <a id="430" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a><a id="437" class="Symbol">;</a> <a id="439" href="Data.Maybe.Base.html#2335" class="Function Operator">_&lt;∣&gt;_</a><a id="444" class="Symbol">;</a> <a id="446" href="Data.Maybe.Base.html#2450" class="Function">when</a><a id="450" class="Symbol">)</a>
<a id="452" class="Keyword">import</a> <a id="459" href="Data.Maybe.Categorical.html" class="Module">Data.Maybe.Categorical</a> <a id="482" class="Symbol">as</a> <a id="485" class="Module">Maybe</a>
<a id="491" class="Keyword">open</a> <a id="496" class="Keyword">import</a> <a id="503" href="Data.Product.html" class="Module">Data.Product</a> <a id="516" class="Keyword">renaming</a> <a id="525" class="Symbol">(</a><a id="526" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">_,_</a> <a id="530" class="Symbol">to</a> <a id="533" class="InductiveConstructor Operator">_,,_</a> <a id="538" class="Symbol">)</a>
<a id="540" class="Keyword">open</a> <a id="545" class="Keyword">import</a> <a id="552" href="Agda.Builtin.String.html" class="Module">Agda.Builtin.String</a>


<a id="574" class="Comment">--our work</a>
<a id="585" class="Keyword">open</a> <a id="590" class="Keyword">import</a> <a id="597" href="basicDataStructure.html" class="Module">basicDataStructure</a>
<a id="616" class="Keyword">open</a> <a id="621" class="Keyword">import</a> <a id="628" href="libraries.natCompare.html" class="Module">libraries.natCompare</a>
<a id="649" class="Keyword">open</a> <a id="654" class="Keyword">import</a> <a id="661" href="Complex-Model.ccomand.ccommands-cresponse.html" class="Module">Complex-Model.ccomand.ccommands-cresponse</a>



<a id="706" class="Comment">--Definition of complex smart contract</a>
<a id="745" class="Keyword">record</a> <a id="Contract"></a><a id="752" href="libraries.Mainlibrary.html#752" class="Record">Contract</a> <a id="761" class="Symbol">:</a> <a id="763" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="767" class="Keyword">where</a>
  <a id="775" class="Keyword">constructor</a> <a id="contract"></a><a id="787" href="libraries.Mainlibrary.html#787" class="InductiveConstructor">contract</a>
  <a id="798" class="Keyword">field</a>
    <a id="Contract.amount"></a><a id="808" href="libraries.Mainlibrary.html#808" class="Field">amount</a>   <a id="817" class="Symbol">:</a> <a id="819" href="basicDataStructure.html#360" class="Function">Amount</a>
    <a id="Contract.fun"></a><a id="830" href="libraries.Mainlibrary.html#830" class="Field">fun</a>  <a id="835" class="Symbol">:</a> <a id="837" href="basicDataStructure.html#172" class="Function">FunctionName</a> <a id="850" class="Symbol">→</a> <a id="852" href="basicDataStructure.html#488" class="Datatype">Msg</a> <a id="856" class="Symbol">→</a> <a id="858" href="Complex-Model.ccomand.ccommands-cresponse.html#1535" class="Datatype">SmartContractExec</a> <a id="876" href="basicDataStructure.html#488" class="Datatype">Msg</a>  
    <a id="Contract.purefunction"></a><a id="886" href="libraries.Mainlibrary.html#886" class="Field">purefunction</a> <a id="899" class="Symbol">:</a> <a id="901" href="basicDataStructure.html#172" class="Function">FunctionName</a> <a id="914" class="Symbol">→</a> <a id="916" href="basicDataStructure.html#488" class="Datatype">Msg</a> <a id="920" class="Symbol">→</a> <a id="922" href="basicDataStructure.html#1428" class="Datatype">MsgOrError</a>  <a id="934" class="Comment">--this one will change because in ether the function no change only the variable can change</a>
   

<a id="1031" class="Keyword">open</a> <a id="1036" href="libraries.Mainlibrary.html#752" class="Module">Contract</a> <a id="1045" class="Keyword">public</a>




<a id="1056" class="Comment">--ledger</a>
<a id="Ledger"></a><a id="1065" href="libraries.Mainlibrary.html#1065" class="Function">Ledger</a> <a id="1072" class="Symbol">:</a> <a id="1074" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="1078" href="libraries.Mainlibrary.html#1065" class="Function">Ledger</a> <a id="1085" class="Symbol">=</a> <a id="1087" href="basicDataStructure.html#387" class="Function">Address</a>  <a id="1096" class="Symbol">→</a> <a id="1098" href="libraries.Mainlibrary.html#752" class="Record">Contract</a>


<a id="1109" class="Comment">-- the execution stack element</a>
<a id="1140" class="Keyword">record</a> <a id="ExecStackEl"></a><a id="1147" href="libraries.Mainlibrary.html#1147" class="Record">ExecStackEl</a> <a id="1159" class="Symbol">:</a> <a id="1161" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1165" class="Keyword">where</a>
  <a id="1173" class="Keyword">constructor</a> <a id="execStackEl"></a><a id="1185" href="libraries.Mainlibrary.html#1185" class="InductiveConstructor">execStackEl</a>
  <a id="1199" class="Keyword">field</a>
    <a id="ExecStackEl.lastCallAddress"></a><a id="1209" href="libraries.Mainlibrary.html#1209" class="Field">lastCallAddress</a> <a id="1225" class="Symbol">:</a> <a id="1227" href="basicDataStructure.html#387" class="Function">Address</a>   <a id="1237" class="Comment">-- the address which made the call to the current function call</a>
    <a id="ExecStackEl.calledAddress"></a><a id="1305" href="libraries.Mainlibrary.html#1305" class="Field">calledAddress</a>   <a id="1321" class="Symbol">:</a> <a id="1323" href="basicDataStructure.html#387" class="Function">Address</a>   <a id="1333" class="Comment">-- is the address to which the last current function call was made from lastCallAddr</a>
    <a id="ExecStackEl.continuation"></a><a id="1422" href="libraries.Mainlibrary.html#1422" class="Field">continuation</a>  <a id="1436" class="Symbol">:</a> <a id="1438" class="Symbol">(</a><a id="1439" href="basicDataStructure.html#488" class="Datatype">Msg</a> <a id="1443" class="Symbol">→</a> <a id="1445" href="Complex-Model.ccomand.ccommands-cresponse.html#1535" class="Datatype">SmartContractExec</a> <a id="1463" href="basicDataStructure.html#488" class="Datatype">Msg</a><a id="1466" class="Symbol">)</a> <a id="1468" class="Comment">-- continuation how to proceed once a result is returned, which depends on that result which is an element of Msg</a>
    <a id="ExecStackEl.costCont"></a><a id="1586" href="libraries.Mainlibrary.html#1586" class="Field">costCont</a>  <a id="1596" class="Symbol">:</a> <a id="1598" href="basicDataStructure.html#488" class="Datatype">Msg</a> <a id="1602" class="Symbol">→</a> <a id="1604" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="1606" class="Comment">-- Cost for continuation depending on the msg returned when the current call is finished</a>
<a id="1695" class="Comment">-- The following two elements are only for debugging purposes so that in case of an error</a>
    <a id="ExecStackEl.funcNameexecStackEl"></a><a id="1789" href="libraries.Mainlibrary.html#1789" class="Field">funcNameexecStackEl</a>  <a id="1810" class="Symbol">:</a> <a id="1812" href="basicDataStructure.html#172" class="Function">FunctionName</a>     <a id="1829" class="Comment">--functionanme is the name of the function which was called</a>

    <a id="ExecStackEl.msgexecStackEl"></a><a id="1894" href="libraries.Mainlibrary.html#1894" class="Field">msgexecStackEl</a>       <a id="1915" class="Symbol">:</a> <a id="1917" href="basicDataStructure.html#488" class="Datatype">Msg</a> <a id="1921" class="Comment">--msg is the arguments with which this funciton was called.</a>
<a id="1981" class="Keyword">open</a> <a id="1986" href="libraries.Mainlibrary.html#1147" class="Module">ExecStackEl</a> <a id="1998" class="Keyword">public</a>


<a id="2007" class="Comment">-- execution stack function</a>
<a id="ExecutionStack"></a><a id="2035" href="libraries.Mainlibrary.html#2035" class="Function">ExecutionStack</a> <a id="2050" class="Symbol">:</a> <a id="2052" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="2056" href="libraries.Mainlibrary.html#2035" class="Function">ExecutionStack</a> <a id="2071" class="Symbol">=</a> <a id="2073" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="2078" href="libraries.Mainlibrary.html#1147" class="Record">ExecStackEl</a>




<a id="2094" class="Comment">-- the state execution function</a>
<a id="2126" class="Keyword">record</a> <a id="StateExecFun"></a><a id="2133" href="libraries.Mainlibrary.html#2133" class="Record">StateExecFun</a> <a id="2146" class="Symbol">:</a> <a id="2148" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="2152" class="Keyword">where</a>
  <a id="2160" class="Keyword">constructor</a> <a id="stateEF"></a><a id="2172" href="libraries.Mainlibrary.html#2172" class="InductiveConstructor">stateEF</a>
  <a id="2182" class="Keyword">field</a>
    <a id="StateExecFun.ledger"></a><a id="2192" href="libraries.Mainlibrary.html#2192" class="Field">ledger</a> <a id="2199" class="Symbol">:</a> <a id="2201" href="libraries.Mainlibrary.html#1065" class="Function">Ledger</a>
    <a id="StateExecFun.executionStack"></a><a id="2212" href="libraries.Mainlibrary.html#2212" class="Field">executionStack</a> <a id="2227" class="Symbol">:</a> <a id="2229" href="libraries.Mainlibrary.html#2035" class="Function">ExecutionStack</a>
    <a id="StateExecFun.initialAddr"></a><a id="2248" href="libraries.Mainlibrary.html#2248" class="Field">initialAddr</a> <a id="2260" class="Symbol">:</a>  <a id="2263" href="basicDataStructure.html#387" class="Function">Address</a> <a id="2271" class="Comment">-- the address which initiated everything</a>
    <a id="StateExecFun.lastCallAddr"></a><a id="2317" href="libraries.Mainlibrary.html#2317" class="Field">lastCallAddr</a>    <a id="2333" class="Symbol">:</a> <a id="2335" href="basicDataStructure.html#387" class="Function">Address</a> <a id="2343" class="Comment">-- the address which made the call to the current function call</a>
    <a id="StateExecFun.calledAddr"></a><a id="2411" href="libraries.Mainlibrary.html#2411" class="Field">calledAddr</a> <a id="2422" class="Symbol">:</a> <a id="2424" href="basicDataStructure.html#387" class="Function">Address</a>   <a id="2434" class="Comment">-- is the address to which the last current fucntion call was made from lastCallAddr</a>
    <a id="StateExecFun.nextstep"></a><a id="2523" href="libraries.Mainlibrary.html#2523" class="Field">nextstep</a>  <a id="2533" class="Symbol">:</a> <a id="2535" href="Complex-Model.ccomand.ccommands-cresponse.html#1535" class="Datatype">SmartContractExec</a> <a id="2553" href="basicDataStructure.html#488" class="Datatype">Msg</a>   <a id="2559" class="Comment">-- next step in the program to be executed when</a>
    <a id="StateExecFun.gasLeft"></a><a id="2611" href="libraries.Mainlibrary.html#2611" class="Field">gasLeft</a>   <a id="2621" class="Symbol">:</a> <a id="2623" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>  <a id="2626" class="Comment">-- how much we have left in the next execution step</a>

<a id="2679" class="Comment">--these info regarding debug info :</a>

    <a id="StateExecFun.funNameevalState"></a><a id="2720" href="libraries.Mainlibrary.html#2720" class="Field">funNameevalState</a> <a id="2737" class="Symbol">:</a> <a id="2739" href="basicDataStructure.html#172" class="Function">FunctionName</a>
    <a id="StateExecFun.msgevalState"></a><a id="2756" href="libraries.Mainlibrary.html#2756" class="Field">msgevalState</a> <a id="2769" class="Symbol">:</a> <a id="2771" href="basicDataStructure.html#488" class="Datatype">Msg</a>
<a id="2775" class="Keyword">open</a> <a id="2780" href="libraries.Mainlibrary.html#2133" class="Module">StateExecFun</a> <a id="2793" class="Keyword">public</a>


</pre></body></html>