<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>libraries.Mainlibrary</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda">
<a id="2" class="Keyword">open</a> <a id="7" class="Keyword">import</a> <a id="14" href="constantparameters.html" class="Module">constantparameters</a>

<a id="34" class="Keyword">module</a> <a id="41" href="libraries.Mainlibrary.html" class="Module">libraries.Mainlibrary</a> <a id="63" class="Keyword">where</a>

<a id="70" class="Keyword">open</a> <a id="75" class="Keyword">import</a> <a id="82" href="Data.Nat.html" class="Module">Data.Nat</a>
<a id="91" class="Keyword">open</a> <a id="96" class="Keyword">import</a> <a id="103" href="Data.List.html" class="Module">Data.List</a> <a id="113" class="Keyword">hiding</a> <a id="120" class="Symbol">(</a><a id="121" href="Data.List.Base.html#1810" class="Function Operator">_++_</a><a id="125" class="Symbol">)</a>
<a id="127" class="Keyword">open</a> <a id="132" class="Keyword">import</a> <a id="139" href="Agda.Builtin.Nat.html" class="Module">Agda.Builtin.Nat</a> <a id="156" class="Keyword">using</a> <a id="162" class="Symbol">(</a><a id="163" href="Agda.Builtin.Nat.html#415" class="Primitive Operator">_-_</a><a id="166" class="Symbol">;</a> <a id="168" href="Agda.Builtin.Nat.html#528" class="Primitive Operator">_*_</a><a id="171" class="Symbol">)</a>
<a id="173" class="Keyword">open</a> <a id="178" class="Keyword">import</a> <a id="185" href="Data.Unit.html" class="Module">Data.Unit</a>
<a id="195" class="Keyword">open</a> <a id="200" class="Keyword">import</a> <a id="207" href="Data.Bool.html" class="Module">Data.Bool</a>
<a id="217" class="Keyword">open</a> <a id="222" class="Keyword">import</a> <a id="229" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a>
<a id="244" class="Keyword">open</a> <a id="249" class="Keyword">import</a> <a id="256" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a>
<a id="270" class="Keyword">open</a> <a id="275" class="Keyword">import</a> <a id="282" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="293" class="Keyword">hiding</a> <a id="300" class="Symbol">(</a><a id="301" href="Data.Maybe.Base.html#2227" class="Function Operator">_&gt;&gt;=_</a><a id="306" class="Symbol">)</a>
<a id="308" class="Keyword">open</a> <a id="313" class="Keyword">import</a> <a id="320" href="Data.String.html" class="Module">Data.String</a> <a id="332" class="Keyword">hiding</a> <a id="339" class="Symbol">(</a><a id="340" href="Data.String.Base.html#2430" class="Function">length</a><a id="346" class="Symbol">;</a><a id="347" href="Data.String.Base.html#1561" class="Primitive">show</a><a id="351" class="Symbol">)</a>
<a id="353" class="Keyword">open</a> <a id="358" class="Keyword">import</a> <a id="365" href="Data.Nat.Show.html" class="Module">Data.Nat.Show</a>
<a id="379" class="Keyword">open</a> <a id="384" class="Keyword">import</a> <a id="391" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="407" class="Symbol">as</a> <a id="410" class="Module">Maybe</a> <a id="416" class="Keyword">using</a> <a id="422" class="Symbol">(</a><a id="423" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a><a id="428" class="Symbol">;</a> <a id="430" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a><a id="437" class="Symbol">;</a> <a id="439" href="Data.Maybe.Base.html#2335" class="Function Operator">_&lt;∣&gt;_</a><a id="444" class="Symbol">;</a> <a id="446" href="Data.Maybe.Base.html#2450" class="Function">when</a><a id="450" class="Symbol">)</a>
<a id="452" class="Keyword">import</a> <a id="459" href="Data.Maybe.Categorical.html" class="Module">Data.Maybe.Categorical</a> <a id="482" class="Symbol">as</a> <a id="485" class="Module">Maybe</a>
<a id="491" class="Keyword">open</a> <a id="496" class="Keyword">import</a> <a id="503" href="Data.Product.html" class="Module">Data.Product</a> <a id="516" class="Keyword">renaming</a> <a id="525" class="Symbol">(</a><a id="526" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">_,_</a> <a id="530" class="Symbol">to</a> <a id="533" class="InductiveConstructor Operator">_,,_</a> <a id="538" class="Symbol">)</a>
<a id="540" class="Keyword">open</a> <a id="545" class="Keyword">import</a> <a id="552" href="Agda.Builtin.String.html" class="Module">Agda.Builtin.String</a>


<a id="574" class="Comment">--our work</a>
<a id="585" class="Keyword">open</a> <a id="590" class="Keyword">import</a> <a id="597" href="basicDataStructure.html" class="Module">basicDataStructure</a>
<a id="616" class="Keyword">open</a> <a id="621" class="Keyword">import</a> <a id="628" href="libraries.natCompare.html" class="Module">libraries.natCompare</a>
<a id="649" class="Keyword">open</a> <a id="654" class="Keyword">import</a> <a id="661" href="Complex-Model.ccomand.ccommands-cresponse.html" class="Module">Complex-Model.ccomand.ccommands-cresponse</a>



<a id="706" class="Comment">--Definition of complex smart contract</a>
<a id="745" class="Keyword">record</a> <a id="Contract"></a><a id="752" href="libraries.Mainlibrary.html#752" class="Record">Contract</a> <a id="761" class="Symbol">:</a> <a id="763" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="767" class="Keyword">where</a>
  <a id="775" class="Keyword">constructor</a> <a id="contract"></a><a id="787" href="libraries.Mainlibrary.html#787" class="InductiveConstructor">contract</a>
  <a id="798" class="Keyword">field</a>
    <a id="Contract.amount"></a><a id="808" href="libraries.Mainlibrary.html#808" class="Field">amount</a>   <a id="817" class="Symbol">:</a> <a id="819" href="basicDataStructure.html#360" class="Function">Amount</a>
    <a id="Contract.fun"></a><a id="830" href="libraries.Mainlibrary.html#830" class="Field">fun</a>  <a id="835" class="Symbol">:</a> <a id="837" href="basicDataStructure.html#172" class="Function">FunctionName</a> <a id="850" class="Symbol">→</a> <a id="852" class="Symbol">(</a><a id="853" href="basicDataStructure.html#488" class="Datatype">Msg</a> <a id="857" class="Symbol">→</a> <a id="859" href="Complex-Model.ccomand.ccommands-cresponse.html#1494" class="Datatype">SmartContractExec</a> <a id="877" href="basicDataStructure.html#488" class="Datatype">Msg</a><a id="880" class="Symbol">)</a>  
    <a id="Contract.purefunction"></a><a id="888" href="libraries.Mainlibrary.html#888" class="Field">purefunction</a> <a id="901" class="Symbol">:</a> <a id="903" href="basicDataStructure.html#172" class="Function">FunctionName</a> <a id="916" class="Symbol">→</a> <a id="918" href="basicDataStructure.html#488" class="Datatype">Msg</a> <a id="922" class="Symbol">→</a> <a id="924" href="basicDataStructure.html#1428" class="Datatype">MsgOrError</a>  <a id="936" class="Comment">--this one will change because in ether the function no change only the variable can change</a>
   

<a id="1033" class="Keyword">open</a> <a id="1038" href="libraries.Mainlibrary.html#752" class="Module">Contract</a> <a id="1047" class="Keyword">public</a>




<a id="1058" class="Comment">--ledger</a>
<a id="Ledger"></a><a id="1067" href="libraries.Mainlibrary.html#1067" class="Function">Ledger</a> <a id="1074" class="Symbol">:</a> <a id="1076" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="1080" href="libraries.Mainlibrary.html#1067" class="Function">Ledger</a> <a id="1087" class="Symbol">=</a> <a id="1089" href="basicDataStructure.html#387" class="Function">Address</a>  <a id="1098" class="Symbol">→</a> <a id="1100" href="libraries.Mainlibrary.html#752" class="Record">Contract</a>


<a id="1111" class="Comment">-- the execution stack element</a>
<a id="1142" class="Keyword">record</a> <a id="ExecStackEl"></a><a id="1149" href="libraries.Mainlibrary.html#1149" class="Record">ExecStackEl</a> <a id="1161" class="Symbol">:</a> <a id="1163" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1167" class="Keyword">where</a>
  <a id="1175" class="Keyword">constructor</a> <a id="execStackEl"></a><a id="1187" href="libraries.Mainlibrary.html#1187" class="InductiveConstructor">execStackEl</a>
  <a id="1201" class="Keyword">field</a>
    <a id="ExecStackEl.lastCallAddress"></a><a id="1211" href="libraries.Mainlibrary.html#1211" class="Field">lastCallAddress</a> <a id="1227" class="Symbol">:</a> <a id="1229" href="basicDataStructure.html#387" class="Function">Address</a>   <a id="1239" class="Comment">-- the address which made the call to the current function call</a>
    <a id="ExecStackEl.calledAddress"></a><a id="1307" href="libraries.Mainlibrary.html#1307" class="Field">calledAddress</a>   <a id="1323" class="Symbol">:</a> <a id="1325" href="basicDataStructure.html#387" class="Function">Address</a>   <a id="1335" class="Comment">-- is the address to which the last current function call was made from lastCallAddr</a>
    <a id="ExecStackEl.continuation"></a><a id="1424" href="libraries.Mainlibrary.html#1424" class="Field">continuation</a>  <a id="1438" class="Symbol">:</a> <a id="1440" href="basicDataStructure.html#488" class="Datatype">Msg</a> <a id="1444" class="Symbol">→</a> <a id="1446" href="Complex-Model.ccomand.ccommands-cresponse.html#1494" class="Datatype">SmartContractExec</a> <a id="1464" href="basicDataStructure.html#488" class="Datatype">Msg</a> <a id="1468" class="Comment">-- continuation how to proceed once a result is returned, which depends on that result which is an element of Msg</a>
    <a id="ExecStackEl.costCont"></a><a id="1586" href="libraries.Mainlibrary.html#1586" class="Field">costCont</a>  <a id="1596" class="Symbol">:</a> <a id="1598" href="basicDataStructure.html#488" class="Datatype">Msg</a> <a id="1602" class="Symbol">→</a> <a id="1604" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="1606" class="Comment">-- Cost for continuation depending on the msg returned when the current call is finished</a>
<a id="1695" class="Comment">-- The following two elements are only for debugging purposes so that in case of an error</a>
    <a id="ExecStackEl.funcNameexecStackEl"></a><a id="1789" href="libraries.Mainlibrary.html#1789" class="Field">funcNameexecStackEl</a>  <a id="1810" class="Symbol">:</a> <a id="1812" href="basicDataStructure.html#172" class="Function">FunctionName</a>     <a id="1829" class="Comment">--functionanme is the name of the function which was called</a>

    <a id="ExecStackEl.msgexecStackEl"></a><a id="1894" href="libraries.Mainlibrary.html#1894" class="Field">msgexecStackEl</a>       <a id="1915" class="Symbol">:</a> <a id="1917" href="basicDataStructure.html#488" class="Datatype">Msg</a> <a id="1921" class="Comment">--msg is the arguments with which this funciton was called.</a>
<a id="1981" class="Keyword">open</a> <a id="1986" href="libraries.Mainlibrary.html#1149" class="Module">ExecStackEl</a> <a id="1998" class="Keyword">public</a>


<a id="2007" class="Comment">-- execution stack function</a>
<a id="ExecutionStack"></a><a id="2035" href="libraries.Mainlibrary.html#2035" class="Function">ExecutionStack</a> <a id="2050" class="Symbol">:</a> <a id="2052" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="2056" href="libraries.Mainlibrary.html#2035" class="Function">ExecutionStack</a> <a id="2071" class="Symbol">=</a> <a id="2073" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="2078" href="libraries.Mainlibrary.html#1149" class="Record">ExecStackEl</a>




<a id="2094" class="Comment">-- definition of state execution function</a>
<a id="2136" class="Keyword">record</a> <a id="StateExecFun"></a><a id="2143" href="libraries.Mainlibrary.html#2143" class="Record">StateExecFun</a> <a id="2156" class="Symbol">:</a> <a id="2158" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="2162" class="Keyword">where</a>
  <a id="2170" class="Keyword">constructor</a> <a id="stateEF"></a><a id="2182" href="libraries.Mainlibrary.html#2182" class="InductiveConstructor">stateEF</a>
  <a id="2192" class="Keyword">field</a>
    <a id="StateExecFun.ledger"></a><a id="2202" href="libraries.Mainlibrary.html#2202" class="Field">ledger</a> <a id="2209" class="Symbol">:</a> <a id="2211" href="libraries.Mainlibrary.html#1067" class="Function">Ledger</a>
    <a id="StateExecFun.executionStack"></a><a id="2222" href="libraries.Mainlibrary.html#2222" class="Field">executionStack</a> <a id="2237" class="Symbol">:</a> <a id="2239" href="libraries.Mainlibrary.html#2035" class="Function">ExecutionStack</a>
    <a id="StateExecFun.initialAddr"></a><a id="2258" href="libraries.Mainlibrary.html#2258" class="Field">initialAddr</a> <a id="2270" class="Symbol">:</a>  <a id="2273" href="basicDataStructure.html#387" class="Function">Address</a> <a id="2281" class="Comment">-- the address which initiated everything</a>
    <a id="StateExecFun.lastCallAddr"></a><a id="2327" href="libraries.Mainlibrary.html#2327" class="Field">lastCallAddr</a>    <a id="2343" class="Symbol">:</a> <a id="2345" href="basicDataStructure.html#387" class="Function">Address</a> <a id="2353" class="Comment">-- the address which made the call to the current function call</a>
    <a id="StateExecFun.calledAddr"></a><a id="2421" href="libraries.Mainlibrary.html#2421" class="Field">calledAddr</a> <a id="2432" class="Symbol">:</a> <a id="2434" href="basicDataStructure.html#387" class="Function">Address</a>   <a id="2444" class="Comment">-- is the address to which the last current fucntion call was made from lastCallAddr</a>
    <a id="StateExecFun.nextstep"></a><a id="2533" href="libraries.Mainlibrary.html#2533" class="Field">nextstep</a>  <a id="2543" class="Symbol">:</a> <a id="2545" href="Complex-Model.ccomand.ccommands-cresponse.html#1494" class="Datatype">SmartContractExec</a> <a id="2563" href="basicDataStructure.html#488" class="Datatype">Msg</a>   <a id="2569" class="Comment">-- next step in the program to be executed when</a>
    <a id="StateExecFun.gasLeft"></a><a id="2621" href="libraries.Mainlibrary.html#2621" class="Field">gasLeft</a>   <a id="2631" class="Symbol">:</a> <a id="2633" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>  <a id="2636" class="Comment">-- how much we have left in the next execution step</a>

<a id="2689" class="Comment">--these info regarding debug info :</a>

    <a id="StateExecFun.funNameevalState"></a><a id="2730" href="libraries.Mainlibrary.html#2730" class="Field">funNameevalState</a> <a id="2747" class="Symbol">:</a> <a id="2749" href="basicDataStructure.html#172" class="Function">FunctionName</a>
    <a id="StateExecFun.msgevalState"></a><a id="2766" href="libraries.Mainlibrary.html#2766" class="Field">msgevalState</a> <a id="2779" class="Symbol">:</a> <a id="2781" href="basicDataStructure.html#488" class="Datatype">Msg</a>
<a id="2785" class="Keyword">open</a> <a id="2790" href="libraries.Mainlibrary.html#2143" class="Module">StateExecFun</a> <a id="2803" class="Keyword">public</a>


</pre></body></html>