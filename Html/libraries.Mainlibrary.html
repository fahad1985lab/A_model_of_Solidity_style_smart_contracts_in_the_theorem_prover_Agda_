<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>libraries.Mainlibrary</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda">
<a id="2" class="Keyword">open</a> <a id="7" class="Keyword">import</a> <a id="14" href="constantparameters.html" class="Module">constantparameters</a>

<a id="34" class="Keyword">module</a> <a id="41" href="libraries.Mainlibrary.html" class="Module">libraries.Mainlibrary</a> <a id="63" class="Keyword">where</a>

<a id="70" class="Keyword">open</a> <a id="75" class="Keyword">import</a> <a id="82" href="Data.Nat.html" class="Module">Data.Nat</a>
<a id="91" class="Keyword">open</a> <a id="96" class="Keyword">import</a> <a id="103" href="Data.List.html" class="Module">Data.List</a> <a id="113" class="Keyword">hiding</a> <a id="120" class="Symbol">(</a><a id="121" href="Data.List.Base.html#1954" class="Function Operator">_++_</a><a id="125" class="Symbol">)</a>
<a id="127" class="Keyword">open</a> <a id="132" class="Keyword">import</a> <a id="139" href="Agda.Builtin.Nat.html" class="Module">Agda.Builtin.Nat</a> <a id="156" class="Keyword">using</a> <a id="162" class="Symbol">(</a><a id="163" href="Agda.Builtin.Nat.html#426" class="Primitive Operator">_-_</a><a id="166" class="Symbol">;</a> <a id="168" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">_*_</a><a id="171" class="Symbol">)</a>
<a id="173" class="Keyword">open</a> <a id="178" class="Keyword">import</a> <a id="185" href="Data.Unit.html" class="Module">Data.Unit</a>
<a id="195" class="Keyword">open</a> <a id="200" class="Keyword">import</a> <a id="207" href="Data.Bool.html" class="Module">Data.Bool</a>
<a id="217" class="Keyword">open</a> <a id="222" class="Keyword">import</a> <a id="229" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a>
<a id="244" class="Keyword">open</a> <a id="249" class="Keyword">import</a> <a id="256" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a>
<a id="270" class="Keyword">open</a> <a id="275" class="Keyword">import</a> <a id="282" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="293" class="Keyword">hiding</a> <a id="300" class="Symbol">(</a><a id="301" href="Data.Maybe.Base.html#2256" class="Function Operator">_&gt;&gt;=_</a><a id="306" class="Symbol">)</a>
<a id="308" class="Keyword">open</a> <a id="313" class="Keyword">import</a> <a id="320" href="Data.String.html" class="Module">Data.String</a> <a id="332" class="Keyword">hiding</a> <a id="339" class="Symbol">(</a><a id="340" href="Data.String.Base.html#2468" class="Function">length</a><a id="346" class="Symbol">;</a><a id="347" href="Data.String.Base.html#1605" class="Primitive">show</a><a id="351" class="Symbol">)</a>
<a id="353" class="Keyword">open</a> <a id="358" class="Keyword">import</a> <a id="365" href="Data.Nat.Show.html" class="Module">Data.Nat.Show</a>
<a id="379" class="Keyword">open</a> <a id="384" class="Keyword">import</a> <a id="391" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="407" class="Symbol">as</a> <a id="410" class="Module">Maybe</a> <a id="416" class="Keyword">using</a> <a id="422" class="Symbol">(</a><a id="423" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a><a id="428" class="Symbol">;</a> <a id="430" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="437" class="Symbol">;</a> <a id="439" href="Data.Maybe.Base.html#2379" class="Function Operator">_&lt;∣&gt;_</a><a id="444" class="Symbol">;</a> <a id="446" href="Data.Maybe.Base.html#2494" class="Function">when</a><a id="450" class="Symbol">)</a>
<a id="452" class="Keyword">import</a> <a id="459" href="Data.Maybe.Effectful.html" class="Module">Data.Maybe.Effectful</a>
<a id="480" class="Keyword">open</a> <a id="485" class="Keyword">import</a> <a id="492" href="Data.Product.html" class="Module">Data.Product</a> <a id="505" class="Keyword">renaming</a> <a id="514" class="Symbol">(</a><a id="515" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,_</a> <a id="519" class="Symbol">to</a> <a id="522" class="InductiveConstructor Operator">_,,_</a> <a id="527" class="Symbol">)</a>
<a id="529" class="Keyword">open</a> <a id="534" class="Keyword">import</a> <a id="541" href="Agda.Builtin.String.html" class="Module">Agda.Builtin.String</a>


<a id="563" class="Comment">--our work</a>
<a id="574" class="Keyword">open</a> <a id="579" class="Keyword">import</a> <a id="586" href="basicDataStructure.html" class="Module">basicDataStructure</a>
<a id="605" class="Keyword">open</a> <a id="610" class="Keyword">import</a> <a id="617" href="libraries.natCompare.html" class="Module">libraries.natCompare</a>
<a id="638" class="Keyword">open</a> <a id="643" class="Keyword">import</a> <a id="650" href="Complex-Model.ccomand.ccommands-cresponse.html" class="Module">Complex-Model.ccomand.ccommands-cresponse</a>



<a id="695" class="Comment">--Definition of complex smart contract</a>
<a id="734" class="Keyword">record</a> <a id="Contract"></a><a id="741" href="libraries.Mainlibrary.html#741" class="Record">Contract</a> <a id="750" class="Symbol">:</a> <a id="752" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="756" class="Keyword">where</a>
  <a id="764" class="Keyword">constructor</a> <a id="contract"></a><a id="776" href="libraries.Mainlibrary.html#776" class="InductiveConstructor">contract</a>
  <a id="787" class="Keyword">field</a>
    <a id="Contract.amount"></a><a id="797" href="libraries.Mainlibrary.html#797" class="Field">amount</a>   <a id="806" class="Symbol">:</a> <a id="808" href="basicDataStructure.html#360" class="Function">Amount</a>
    <a id="Contract.fun"></a><a id="819" href="libraries.Mainlibrary.html#819" class="Field">fun</a>  <a id="824" class="Symbol">:</a> <a id="826" href="basicDataStructure.html#172" class="Function">FunctionName</a> <a id="839" class="Symbol">→</a> <a id="841" href="basicDataStructure.html#488" class="Datatype">Msg</a> <a id="845" class="Symbol">→</a> <a id="847" href="Complex-Model.ccomand.ccommands-cresponse.html#1514" class="Datatype">SmartContractExec</a> <a id="865" href="basicDataStructure.html#488" class="Datatype">Msg</a>  
    <a id="Contract.purefunction"></a><a id="875" href="libraries.Mainlibrary.html#875" class="Field">purefunction</a> <a id="888" class="Symbol">:</a> <a id="890" href="basicDataStructure.html#172" class="Function">FunctionName</a> <a id="903" class="Symbol">→</a> <a id="905" href="basicDataStructure.html#488" class="Datatype">Msg</a> <a id="909" class="Symbol">→</a> <a id="911" href="basicDataStructure.html#1428" class="Datatype">MsgOrError</a>  <a id="923" class="Comment">--this one will change because in ether the function no change only the variable can change</a>
    <a id="Contract.purefunctionCost"></a><a id="1019" href="libraries.Mainlibrary.html#1019" class="Field">purefunctionCost</a> <a id="1036" class="Symbol">:</a> <a id="1038" href="basicDataStructure.html#172" class="Function">FunctionName</a> <a id="1051" class="Symbol">→</a> <a id="1053" href="basicDataStructure.html#488" class="Datatype">Msg</a> <a id="1057" class="Symbol">→</a> <a id="1059" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>   

<a id="1065" class="Keyword">open</a> <a id="1070" href="libraries.Mainlibrary.html#741" class="Module">Contract</a> <a id="1079" class="Keyword">public</a>




<a id="1090" class="Comment">--ledger</a>
<a id="Ledger"></a><a id="1099" href="libraries.Mainlibrary.html#1099" class="Function">Ledger</a> <a id="1106" class="Symbol">:</a> <a id="1108" href="Agda.Primitive.html#388" class="Primitive">Set</a>
<a id="1112" href="libraries.Mainlibrary.html#1099" class="Function">Ledger</a> <a id="1119" class="Symbol">=</a> <a id="1121" href="basicDataStructure.html#387" class="Function">Address</a>  <a id="1130" class="Symbol">→</a> <a id="1132" href="libraries.Mainlibrary.html#741" class="Record">Contract</a>


<a id="1143" class="Comment">-- the execution stack element</a>
<a id="1174" class="Keyword">record</a> <a id="ExecStackEl"></a><a id="1181" href="libraries.Mainlibrary.html#1181" class="Record">ExecStackEl</a> <a id="1193" class="Symbol">:</a> <a id="1195" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1199" class="Keyword">where</a>
  <a id="1207" class="Keyword">constructor</a> <a id="execStackEl"></a><a id="1219" href="libraries.Mainlibrary.html#1219" class="InductiveConstructor">execStackEl</a>
  <a id="1233" class="Keyword">field</a>
    <a id="ExecStackEl.lastCallAddress"></a><a id="1243" href="libraries.Mainlibrary.html#1243" class="Field">lastCallAddress</a> <a id="1259" class="Symbol">:</a> <a id="1261" href="basicDataStructure.html#387" class="Function">Address</a>   <a id="1271" class="Comment">-- the address which made the call to the current function call</a>
    <a id="ExecStackEl.calledAddress"></a><a id="1339" href="libraries.Mainlibrary.html#1339" class="Field">calledAddress</a>   <a id="1355" class="Symbol">:</a> <a id="1357" href="basicDataStructure.html#387" class="Function">Address</a>   <a id="1367" class="Comment">-- is the address to which the last current function call was made from lastCallAddr</a>
    <a id="ExecStackEl.continuation"></a><a id="1456" href="libraries.Mainlibrary.html#1456" class="Field">continuation</a>  <a id="1470" class="Symbol">:</a> <a id="1472" class="Symbol">(</a><a id="1473" href="basicDataStructure.html#488" class="Datatype">Msg</a> <a id="1477" class="Symbol">→</a> <a id="1479" href="Complex-Model.ccomand.ccommands-cresponse.html#1514" class="Datatype">SmartContractExec</a> <a id="1497" href="basicDataStructure.html#488" class="Datatype">Msg</a><a id="1500" class="Symbol">)</a> <a id="1502" class="Comment">-- continuation how to proceed once a result is returned, which depends on that result which is an element of Msg</a>
    <a id="ExecStackEl.costCont"></a><a id="1620" href="libraries.Mainlibrary.html#1620" class="Field">costCont</a>  <a id="1630" class="Symbol">:</a> <a id="1632" href="basicDataStructure.html#488" class="Datatype">Msg</a> <a id="1636" class="Symbol">→</a> <a id="1638" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="1640" class="Comment">-- Cost for continuation depending on the msg returned when the current call is finished</a>
<a id="1729" class="Comment">-- The following two elements are only for debugging purposes so that in case of an error</a>
    <a id="ExecStackEl.funcNameexecStackEl"></a><a id="1823" href="libraries.Mainlibrary.html#1823" class="Field">funcNameexecStackEl</a>  <a id="1844" class="Symbol">:</a> <a id="1846" href="basicDataStructure.html#172" class="Function">FunctionName</a>     <a id="1863" class="Comment">--functionanme is the name of the function which was called</a>

    <a id="ExecStackEl.msgexecStackEl"></a><a id="1928" href="libraries.Mainlibrary.html#1928" class="Field">msgexecStackEl</a>       <a id="1949" class="Symbol">:</a> <a id="1951" href="basicDataStructure.html#488" class="Datatype">Msg</a> <a id="1955" class="Comment">--msg is the arguments with which this funciton was called.</a>
<a id="2015" class="Keyword">open</a> <a id="2020" href="libraries.Mainlibrary.html#1181" class="Module">ExecStackEl</a> <a id="2032" class="Keyword">public</a>


<a id="2041" class="Comment">-- execution stack function</a>
<a id="ExecutionStack"></a><a id="2069" href="libraries.Mainlibrary.html#2069" class="Function">ExecutionStack</a> <a id="2084" class="Symbol">:</a> <a id="2086" href="Agda.Primitive.html#388" class="Primitive">Set</a>
<a id="2090" href="libraries.Mainlibrary.html#2069" class="Function">ExecutionStack</a> <a id="2105" class="Symbol">=</a> <a id="2107" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2112" href="libraries.Mainlibrary.html#1181" class="Record">ExecStackEl</a>




<a id="2128" class="Comment">-- the state execution function</a>
<a id="2160" class="Keyword">record</a> <a id="StateExecFun"></a><a id="2167" href="libraries.Mainlibrary.html#2167" class="Record">StateExecFun</a> <a id="2180" class="Symbol">:</a> <a id="2182" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="2186" class="Keyword">where</a>
  <a id="2194" class="Keyword">constructor</a> <a id="stateEF"></a><a id="2206" href="libraries.Mainlibrary.html#2206" class="InductiveConstructor">stateEF</a>
  <a id="2216" class="Keyword">field</a>
    <a id="StateExecFun.ledger"></a><a id="2226" href="libraries.Mainlibrary.html#2226" class="Field">ledger</a> <a id="2233" class="Symbol">:</a> <a id="2235" href="libraries.Mainlibrary.html#1099" class="Function">Ledger</a>
    <a id="StateExecFun.executionStack"></a><a id="2246" href="libraries.Mainlibrary.html#2246" class="Field">executionStack</a> <a id="2261" class="Symbol">:</a> <a id="2263" href="libraries.Mainlibrary.html#2069" class="Function">ExecutionStack</a>
    <a id="StateExecFun.initialAddr"></a><a id="2282" href="libraries.Mainlibrary.html#2282" class="Field">initialAddr</a> <a id="2294" class="Symbol">:</a>  <a id="2297" href="basicDataStructure.html#387" class="Function">Address</a> <a id="2305" class="Comment">-- the address which initiated everything</a>
    <a id="StateExecFun.lastCallAddr"></a><a id="2351" href="libraries.Mainlibrary.html#2351" class="Field">lastCallAddr</a>    <a id="2367" class="Symbol">:</a> <a id="2369" href="basicDataStructure.html#387" class="Function">Address</a> <a id="2377" class="Comment">-- the address which made the call to the current function call</a>
    <a id="StateExecFun.calledAddr"></a><a id="2445" href="libraries.Mainlibrary.html#2445" class="Field">calledAddr</a> <a id="2456" class="Symbol">:</a> <a id="2458" href="basicDataStructure.html#387" class="Function">Address</a>   <a id="2468" class="Comment">-- is the address to which the last current fucntion call was made from lastCallAddr</a>
    <a id="StateExecFun.nextstep"></a><a id="2557" href="libraries.Mainlibrary.html#2557" class="Field">nextstep</a>  <a id="2567" class="Symbol">:</a> <a id="2569" href="Complex-Model.ccomand.ccommands-cresponse.html#1514" class="Datatype">SmartContractExec</a> <a id="2587" href="basicDataStructure.html#488" class="Datatype">Msg</a>   <a id="2593" class="Comment">-- next step in the program to be executed when</a>
    <a id="StateExecFun.gasLeft"></a><a id="2645" href="libraries.Mainlibrary.html#2645" class="Field">gasLeft</a>   <a id="2655" class="Symbol">:</a> <a id="2657" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>  <a id="2660" class="Comment">-- how much we have left in the next execution step</a>

<a id="2713" class="Comment">--these info regarding debug info :</a>

    <a id="StateExecFun.funNameevalState"></a><a id="2754" href="libraries.Mainlibrary.html#2754" class="Field">funNameevalState</a> <a id="2771" class="Symbol">:</a> <a id="2773" href="basicDataStructure.html#172" class="Function">FunctionName</a>
    <a id="StateExecFun.msgevalState"></a><a id="2790" href="libraries.Mainlibrary.html#2790" class="Field">msgevalState</a> <a id="2803" class="Symbol">:</a> <a id="2805" href="basicDataStructure.html#488" class="Datatype">Msg</a>
<a id="2809" class="Keyword">open</a> <a id="2814" href="libraries.Mainlibrary.html#2167" class="Module">StateExecFun</a> <a id="2827" class="Keyword">public</a>


</pre></body></html>